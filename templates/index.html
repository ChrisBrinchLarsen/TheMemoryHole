{% extends 'base.html' %}

{% block head %}
<title>The Memory Hole</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registers.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/visualizer.css') }}">
<script type="text/javascript">
    socket.on('redirect', function(data) {
        window.location.href = data["url"];
    });
</script>

{% endblock %}


{% block body %}
<div class="full-container" style="display: flex;">
    <div id="navbar" class="center">
      <h1 style="padding-left: 0.5rem;">The Memory Hole</h1>
      <div style="align-content: center; margin-right: 1rem;">
       <!-- <select name="predefined-architectures" id="architecture-dropdown"> -->
            <select name="predefined-architectures" id="architecture-dropdown" onchange="preset_architecture(JSON.parse(this.value)); this.selectedindex = -1">
            <option disabled selected value>Sample Architectures</option>
            <option value='[[6,1,4,1], [7,1,4,2]]'>Simple CPU</option>
            <option value='[[7,1,4,2],[9,1,4,4],[11,1,4,8]]'>Intermediate CPU</option>
            <option value='[[10,32,6,8],[10,256,6,12],[20,4,6,16]]'>Realistic Low-end CPU</option>
            <option value='[[10,64,6,8],[10,1024,6,12],[20,8,6,16]]'>Realistic Mid-end CPU</option>
            <option value='[[10,128,7,8],[20,2,7,12],[20,16,7,16]]'>Realistic High-end CPU</option>
            <option value='[[10,32,6,4],[10,512,6,16]]'>Raspberry Pi3</option>
        </select>
        <select name="predefined-Programs" id="program-dropdown" onchange="preset_program(this.value); this.selectedindex = -1">
            <option disabled selected value>Sample Programs</option>
            <option value="{{ url_for('static', filename='programs/fib.c') }}">Fibonacci</option>
            <option value="{{ url_for('static', filename='programs/matrix_good.c') }}">Good Matrix</option>
            <option value="{{ url_for('static', filename='programs/matrix_bad.c') }}">Bad Matrix</option>
            <option value="{{ url_for('static', filename='programs/random.c') }}">Random Accesses</option>
            <option value="{{ url_for('static', filename='programs/raspberry_fillcache.c') }}">Raspberry fill L1</option>
        </select>
     </div>
    </div>
    <div id="main-content">
        <div id="architecture">
            <button id="add-cache" onclick="addCache()">Add Cache +</button>
        </div>
        <div id="program_side">
            <textarea id="programText" rows="25" cols="50" placeholder="Source code.."></textarea><br>
            <textarea id="args" rows="1" cols="50" placeholder="Input space separated argument list.."></textarea><br>
            <input type="submit" value="Run Code" onclick="sendProgram()">
        </div>
    </div>
</div>


<div class="full-container" style="display: none;">
    <div id="navbar">
        <div style="display: flex; flex-direction: row; width: 60%;"> 
            <h1 id="instr_counter"></h1>
            <div id="controller" style="display: flex; flex-direction: row;">
                <button id="play-button" onclick="play()" class="img-button"><img src="{{ url_for('static', filename='images/play.png') }}" class="img-icon"></button>
                <button id="pause-button" onclick="pause()" class="img-button" style="display: none;"><img src="{{ url_for('static', filename='images/pause.png') }}" class="img-icon"></button>
                <button id="next-button" onclick="next()" class="img-button"><img src="{{ url_for('static', filename='images/next.png') }}" class="img-icon"></button>
                <button id="end-button" onclick="end()" class="img-button">END</button>
                <h2>Delay:<input id="delay-input" min="0" class="num-box" type="number" value="100">ms</h2>
            </div>
        </div>
        <h1 id="instr" style="text-align: right;"></h1>
    </div>
    <div id="registers">
        <div class="register">x0</div>
        <div class="register">ra</div>
        <div class="register">sp</div>
        <div class="register">gp</div>
        <div class="register">tp</div>
        <div class="register">t0</div>
        <div class="register">t1</div>
        <div class="register">t2</div>
        <div class="register">s0</div>
        <div class="register">s1</div>
        <div  class="register">a0</div>
        <div  class="register">a1</div>
        <div  class="register">a2</div>
        <div  class="register">a3</div>
        <div  class="register">a4</div>
        <div  class="register">a5</div>
        <div  class="register">a6</div>
        <div  class="register">a7</div>
        <div  class="register">s2</div>
        <div  class="register">s3</div>
        <div  class="register">s4</div>
        <div  class="register">s5</div>
        <div  class="register">s6</div>
        <div  class="register">s7</div>
        <div  class="register">s8</div>
        <div  class="register">s9</div>
        <div  class="register">s10</div>
        <div  class="register">s11</div>
        <div  class="register">t3</div>
        <div  class="register">t4</div>
        <div  class="register">t5</div>
        <div  class="register">t6</div>
    </div>
        <div id="side-holder">
            <div id="left-visualizer">
                <div id="running-summary" class="summary">
                    <h1>Running Summary</h1>
                    <div>Memory Accesses: <span id="memory-accesses">0</span></div>
                </div>
                <div id="line-summary" class="summary" style="display: none;">
                    <div style="display: flex; flex-direction: row; justify-content: space-between;">
                        <h1>Line <span id="summary-line-nr"></span></h1>
                        <button onclick="returnToSummary()" class="x-button">X</button>
                    </div>
                    <div>Hits: <span id="summary-line-hits"></span></div>
                    <div>Misses: <span id="summary-line-misses"></span></div>
                    <div>Miss-rate: <span id="summary-line-miss-rate"></span>%</div>

                </div>
                <div id="code-viewer">
                    <div class="src-line">Hello &lt</div>
                    <div class="src-line active">Ayo ello queen</div>
                    <div class="src-line">Duwop</div>
                </div>
            </div>
            <div id="right-visualizer">
                <div id="caches"><div class="cache"><h1>L1</h1><div class="cache-info"><div class="split_addr"><span style="color: red;">00000000000000000000000000</span>|<span style="color: green;">00</span>|<span style="color: blue;">0000</span></div><div class="set"><div class="line valid"></div></div><div class="set"><div class="line valid"></div></div><div class="set"><div class="line valid"></div></div><div class="set"><div class="line valid"></div></div></div></div><div class="cache"><h1>L2</h1><div class="cache-info"><div class="split_addr"><span style="color: red;">00000000000000000000000000</span>|<span style="color: green;">00</span>|<span style="color: blue;">0000</span></div><div class="set"><div class="line valid"></div><div class="line valid"></div></div><div class="set"><div class="line valid"></div><div class="line valid"></div></div><div class="set"><div class="line valid"></div><div class="line valid"></div></div><div class="set"><div class="line valid"></div><div class="line valid"></div></div></div></div></div>
            </div>
        </div>
    <div id="visualizer">

    </div>
</div>

<script src="{{ url_for('static', filename='scripts/constants.js') }}"></script>
<script src="{{ url_for('static', filename='scripts/visualizer.js') }}"></script>
<script src="{{ url_for('static', filename='scripts/main.js') }}"></script>
{% endblock %}
